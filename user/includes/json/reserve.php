<?phpinclude('config.php');$suc ='1';$er='0';$err='';$id ='';$json =[];$rows = [];$iduser='';if(isset($_COOKIE['iduser'])){$iduser = $_COOKIE['iduser'];}if(isset($_POST["date1"])) {    $obj = json_decode($_POST["date1"]);    $date1 = trim(strip_tags($obj->ladate));    $dat1 = date('Y-m', strtotime($date1));    $date= date('Y-m-d H:i:s');    $req1 = $bdd->prepare("select * from rendezvous  where DATE_FORMAT(dateStart,'%Y-%m') = ? and dateStart > ?");    $req1->execute(array($dat1,$date));    while ($ar = $req1->fetch()) {        $datedebut = date('Y-m-d', strtotime($ar['dateStart']));        $datefin = date('Y-m-d', strtotime($ar['dateEnd']));        $datedebut2 = date('Y-m-d H:i:s', strtotime($ar['dateStart']));$h1 = date('H', strtotime($ar['dateStart']));$m1 = date('i', strtotime($ar['dateStart']));        $datefin2 = date('Y-m-d H:i:s', strtotime($ar['dateEnd']));$h2 = date('H', strtotime($ar['dateEnd']));$m2 = date('i', strtotime($ar['dateEnd']));        $date1 = date_create($datedebut2);        $date2 = date_create($datefin2);        $diff = date_diff($date1, $date2);        $m = $diff->i;        $h = $diff->h;        $d = date('d', strtotime($ar['dateStart']));        $td='';        $hour1 = date('H:i:s', strtotime($ar['dateStart']));        $hour2 = date('H:i:s', strtotime($ar['dateEnd']));        if(intval($h1) == 00 ){ $h1=0; }if(intval($h2) == 00 ){ $h2=0; }        if(intval($h1) < 10 and $h1 != '00'){ $h1=str_replace('0','',$h1); }if(intval($h2) < 10 and $h2 != '00' ){ $h2=str_replace('0','',$h2); }        $req2 = $bdd->prepare("select * from reservations  where  idconference = ?");        $req2->execute(array($ar['idr']));        while ($ar2 = $req2->fetch()) {           $ah1 = date('H', strtotime($ar2['startrdv']));$am1 = date('i', strtotime($ar2['startrdv']));           $ah2 = date('H', strtotime($ar2['endrdv']));$am2 = date('i', strtotime($ar2['endrdv']));            for($i=$h1;($i+1)<=$h2;$i++){                if($i<=$ah1 and ($i+1) >= $ah1){$td .= $i.' - '.($i+1). 'réservé ';}else{$td .='';}            }        }        array_push($rows, $td);        $result = ['id' => $ar['idr'], 'title' => $ar['titre'],            'start' => $datedebut . 'T' . $hour1,            'end' => $datefin . 'T' . $hour2,            'constraint' => 'businessHours',            'h' => $h1,            'h2' => $h2,            'm' => $m,            'd' => $d,            'allDay' => false,            'color' => $ar['paid'] == '1' ? 'red' : '#00ff00'];        array_push($json, $result);    }//$json  = ['id' => '7','title'=> 'Math',  'start'=> '2020-02-03T13:00:00', 'end'=> '2020-02-03T14:00:00','constraint' => 'businessHours','allDay' => false,'color'=> '#00ff00'];    echo json_encode(array('suc' => (string)$suc, 'err' => (string)$err, 'er' => (string)$er, 'dta' => $json, 'dta2' => $rows));}